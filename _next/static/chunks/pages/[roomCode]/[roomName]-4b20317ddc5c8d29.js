(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[541],{1736:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[roomCode]/[roomName]",function(){return n(7024)}])},3591:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var r=n(5893),o=n(4184),i=n.n(o);n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function c(e){var t=e.color,n=void 0===t?"indigo":t,o=e.icon,c=e.fill,l=void 0!==c&&c,s=e.square,d=void 0!==s&&s,f=e.text,v=u(e,["color","icon","fill","square","text"]),b=i()("flex flex-row space-x-2 items-center justify-center rounded-md p-2 px-4 text-white focus:outline focus:outline-yellow-500 relative",{"w-full":l,"w-10 h-10":d,"bg-indigo-500 hover:bg-indigo-600 active:bg-indigo-700":"indigo"===n,"bg-slate-700 hover:bg-slate-600 active:bg-slate-500":"slate"===n,"bg-red-500 hover:bg-red-600 active:bg-red-700":"red"===n});return(0,r.jsxs)("button",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){a(e,t,n[t])}))}return e}({type:"button",className:b},v,{children:[o&&o,(0,r.jsx)("span",{children:f})]}))}},9896:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(5893),o=n(4184),i=n.n(o),a=n(7294);function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function l(e){var t=e.borderless,n=void 0!==t&&t,o=e.handleChange,l=e.id,s=e.placeholder,d=e.value,f=c(e,["borderless","handleChange","id","placeholder","value"]),v=a.useCallback((function(e){o(e.target.value)}),[o]),b=i()("p-2 text-black rounded-md w-full border border-slate-300 focus:outline focus:outline-yellow-500",{"border-none":n});return(0,r.jsx)("input",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){u(e,t,n[t])}))}return e}({className:b,id:l,onChange:v,placeholder:s,type:"text",value:d},f))}},1064:function(e,t,n){"use strict";n.d(t,{Q6:function(){return i},zD:function(){return a},dr:function(){return u}});var r=n(9835),o=function(e,t){return r.unique("".concat(e).concat(t))},i=function(e){var t=(+new Date).toString(36).slice(-5);return t+o(t,e)},a=function(e,t){try{var n=e.substr(0,5);if(e.substr(5)!==o(n,t))throw new Error("Bad room hash")}catch(r){throw console.error(r),new Error("Invalid room code")}},u=function(){return Math.random().toString(16).substr(2,8)}},7024:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Ke}});var r=n(4051),o=n.n(r),i=n(5893),a=n(7294),u=n(2804),c=n(1163),l=n(1064),s=n(8158);function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){f(e,t,n[t])}))}return e}function b(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var m=[],p=(0,u.cn)({key:"peersState",default:m}),h=function(e){return function(t){return b(t).concat([{sid:e,status:"connecting",audioEnabled:!1,videoEnabled:!1}])}},y=function(e){return function(t){return void 0===t.find((function(t){return t.sid===e}))?(console.warn("Peer disconnected, but cannot be found in peers"),t):t.filter((function(t){return t.sid!==e}))}},x=function(e){return function(t){return console.debug("peer fully connected ".concat(e)),t.map((function(t){return t.sid!==e?t:v({},t,{status:"connected"})}))}},g=function(e,t,n,r){return function(o){return o.map((function(o){return o.sid!==e?o:v({},o,{name:t,audioEnabled:n,videoEnabled:r})}))}},w=n(9282),j=n.n(w);function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){O(e,t,n[t])}))}return e}var E="local",k={status:"requestingName"},N=(0,u.cn)({key:"localState",default:k}),C=function(e,t){return function(n){return j()("connecting"===n.status||"connected"===n.status),S({},n,{audioEnabled:e,videoEnabled:t})}},A=function(e,t){return function(n){return j()("requestingDevices"===n.status),S({},n,{status:"connecting",audioEnabled:e,videoEnabled:t})}},P=function(e){return j()("requestingPermissions"===e.status),S({},e,{status:"requestingDevices"})},I=function(e){return function(t){return j()("requestingName"===t.status),localStorage.setItem("name",e),S({},t,{name:e,status:"requestingPermissions"})}},D=function(e){return j()("connecting"===e.status||"connected"===e.status),S({},e,{status:"connected"})},q=new Map,T=new Map,R=new Map,M=function(e,t){var n=e.get(t);if(void 0===n)throw new Error("Failed to find key in map");return n};function _(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(l){return void n(l)}u.done?t(c):Promise.resolve(c).then(r,o)}function V(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){_(i,r,o,a,u,"next",e)}function u(e){_(i,r,o,a,u,"throw",e)}a(void 0)}))}}var L=function(e){null!==e&&e.getTracks().forEach((function(e){e.stop()}))},F=function(){var e=V(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",navigator.mediaDevices.getUserMedia(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=V(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={audio:[],selectedAudio:null,video:[],selectedVideo:null},e.next=3,navigator.mediaDevices.enumerateDevices();case 3:return e.sent.forEach((function(e){if(""!==e.label){var n={id:e.deviceId,name:e.label};e.kind.toLowerCase().includes("audio")&&(t.audio.push(n),null===t.selectedAudio&&(t.selectedAudio=n)),e.kind.toLowerCase().includes("video")&&(t.video.push(n),null===t.selectedVideo&&(t.selectedVideo=n))}})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Z=function(){var e=V(o().mark((function e(){var t,n,r,i,a,u=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},n=t.audioDeviceId,r=t.videoDeviceId,i=void 0===n||{deviceId:n},a=void 0===r||{deviceId:r},e.prev=3,e.next=6,F({video:a,audio:i});case 6:case 15:case 24:return e.abrupt("return",e.sent);case 9:return e.prev=9,e.t0=e.catch(3),console.error(e.t0),e.prev=12,e.next=15,F({audio:i});case 18:return e.prev=18,e.t1=e.catch(12),console.error(e.t1),e.prev=21,e.next=24,F({video:a});case 27:return e.prev=27,e.t2=e.catch(21),console.error(e.t2),e.abrupt("return",null);case 31:case"end":return e.stop()}}),e,null,[[3,9],[12,18],[21,27]])})));return function(){return e.apply(this,arguments)}}(),B=function(e){if(null===e)return{audioEnabled:!1,videoEnabled:!1};var t=e.getVideoTracks(),n=e.getAudioTracks(),r=void 0!==t&&t.length>0&&t[0].enabled;return{audioEnabled:void 0!==n&&n.length>0&&n[0].enabled,videoEnabled:r}},J=function(e,t){e.send(JSON.stringify(t))},$=function(e,t,n,r){j()("requestingName"!==n.status&&"requestingPermissions"!==n.status),t.onopen=function(){var e=M(R,E),r=B(e),o=r.audioEnabled,i=r.videoEnabled;J(t,{type:"peer-state",name:n.name,audioEnabled:o,videoEnabled:i})},t.onmessage=function(t){var n=JSON.parse(t.data);if("peer-state"===n.type)!function(e,t,n){console.debug("received peer state sid=[".concat(e,"] name=[").concat(t.name,"] audioEnabled=[").concat(t.audioEnabled,"] videoEnabled=[").concat(t.videoEnabled,"]")),n(g(e,t.name,t.audioEnabled,t.videoEnabled))}(e,n,r)},T.set(e,t)},G={iceServers:[{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}]},z=function(e,t,n,r,o){j()("connecting"===t.status);var i=new RTCPeerConnection(G),a=M(R,E);if(null===a||void 0===a||a.getTracks().forEach((function(e){i.addTrack(e,a)})),i.ontrack=function(e){e.streams.length>0&&R.set(n,e.streams[0])},i.onicecandidate=function(t){var o;console.debug("ice candidate",null===(o=t.candidate)||void 0===o?void 0:o.candidate,i.iceConnectionState),null!==t.candidate&&e.emit("webRtcIceCandidate",{sid:n,label:t.candidate.sdpMLineIndex,candidate:t.candidate.candidate}),"connected"!==i.iceConnectionState&&"completed"!==i.iceConnectionState||r(x(n))},o){var u=i.createDataChannel("data");$(n,u,t,r)}else i.ondatachannel=function(e){$(n,e.channel,t,r)};return i},W=n(3454);function X(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(l){return void n(l)}u.done?t(c):Promise.resolve(c).then(r,o)}function Y(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){X(i,r,o,a,u,"next",e)}function u(e){X(i,r,o,a,u,"throw",e)}a(void 0)}))}}var H=function(e,t,n){return function(){console.debug("connected"),e.emit("joinRoom",t),n(D)}},Q=function(e,t,n){return function(){var r=Y(o().mark((function r(i){var a,u;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(console.debug("peerConnect sid=".concat(i)),!q.get(i)){r.next=4;break}return console.warn("Received connect from known peer"),r.abrupt("return");case 4:return a=z(e,t,i,n,!0),q.set(i,a),r.next=8,a.createOffer();case 8:u=r.sent,a.setLocalDescription(u),n(h(i)),e.emit("webRtcOffer",{offerSdp:u,sid:i});case 12:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()},K=function(e){return function(t){console.debug("peerDisconnect sid=".concat(t));var n=q.get(t);null===n||void 0===n||n.close(),q.delete(t);var r=T.get(t);null===r||void 0===r||r.close(),T.delete(t),R.delete(t),e(y(t))}},ee=function(e,t,n){return function(){var r=Y(o().mark((function r(i){var a,u,c,l;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=i.offerSdp,u=i.sid,console.debug("webRtcOffer fromSid=".concat(e.id," toSid=").concat(u)),c=z(e,t,u,n,!1),q.set(u,c),n(h(u)),c.setRemoteDescription(new RTCSessionDescription(a)),r.next=8,c.createAnswer();case 8:l=r.sent,c.setLocalDescription(l),e.emit("webRtcAnswer",{answerSdp:l,sid:u});case 11:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()},te=function(e){return function(t){console.debug("webRtcAnswer fromSid=".concat(e.id," toSid=").concat(t.sid)),M(q,t.sid).setRemoteDescription(new RTCSessionDescription(t.answerSdp))}},ne=function(e){return function(t){var n=M(q,t.sid);console.debug("received ice candidate",t.candidate,n.iceConnectionState),n.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:t.label,candidate:t.candidate})),"connected"!==n.iceConnectionState&&"completed"!==n.iceConnectionState||e(x(t.sid))}},re=function(){var e=Y(o().mark((function e(t,n,r,i,a){var u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j()(void 0!==W.env.NEXT_PUBLIC_SIGNALLING_URL),u=(0,s.io)(W.env.NEXT_PUBLIC_SIGNALLING_URL),r.current=u,u.on("connected",H(u,t,i)),u.on("peerConnect",Q(u,n,a)),u.on("peerDisconnect",K(a)),u.on("webRtcOffer",ee(u,n,a)),u.on("webRtcAnswer",te(u)),u.on("webRtcIceCandidate",ne(a));case 9:case"end":return e.stop()}}),e)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),oe={status:"loading"},ie=(0,u.cn)({key:"roomState",default:oe}),ae=function(){return{status:"error",error:"Invalid room"}},ue=function(e){return function(){return{status:"ready",name:e}}},ce=n(9896);function le(e){var t=e.htmlFor,n=e.text;return(0,i.jsx)("label",{htmlFor:t,children:n})}var se=n(4184),de=n.n(se);function fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ve(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function be(e){var t=e.fill,n=void 0!==t&&t,r=e.text,o=ve(e,["fill","text"]),a=de()("flex flex-row space-x-2 items-center justify-center rounded-md p-2 px-4 text-white bg-indigo-500 hover:bg-indigo-600 active:bg-indigo-700 focus:outline focus:outline-yellow-500 cursor-pointer",{"w-full":n});return(0,i.jsx)("input",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){fe(e,t,n[t])}))}return e}({type:"submit",className:a},o,{value:r}))}function me(e){var t=e.body,n=e.handleSubmit,r=e.submitText,o=a.useCallback((function(e){e.preventDefault(),n()}),[n]);return(0,i.jsx)("form",{className:"flex w-full h-full items-center justify-center text-black",onSubmit:o,children:(0,i.jsxs)("div",{className:"flex flex-col w-80 rounded-lg bg-white",children:[(0,i.jsx)("div",{className:"flex flex-col flex-grow p-4 space-y-2",children:t}),(0,i.jsx)("div",{className:"p-4 border-t border-slate-300",children:(0,i.jsx)(be,{text:r,fill:!0})})]})})}function pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function he(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return pe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(){var e,t=(0,u.Zl)(N),n=he(a.useState(null!==(e=localStorage.getItem("name"))&&void 0!==e?e:""),2),r=n[0],o=n[1],c=a.useCallback((function(){t(I(r))}),[r,t]);return(0,i.jsx)(me,{body:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(le,{htmlFor:"name",text:"Your name"}),(0,i.jsx)(ce.Z,{handleChange:o,id:"name",placeholder:"Enter your name",required:!0,value:r})]}),handleSubmit:c,submitText:"Continue"})}function xe(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(l){return void n(l)}u.done?t(c):Promise.resolve(c).then(r,o)}function ge(){var e,t=(0,u.Zl)(N),n=a.useCallback((e=o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z();case 2:n=e.sent,R.set(E,n),t(P);case 5:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){xe(i,r,o,a,u,"next",e)}function u(e){xe(i,r,o,a,u,"throw",e)}a(void 0)}))}),[t]);return(0,i.jsx)(me,{body:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{children:"To be able to share your camera and microphone, p2p.chat will request access to these devices."}),(0,i.jsx)("div",{className:"text-slate-500",children:"You'll still be able to stop sharing your devices at any time."})]}),handleSubmit:n,submitText:"Request permissions"})}var we=n(3801),je=n(482);function Oe(e){var t,n=e.id,r=e.fallback,o=e.icon,a=e.label,u=e.options,c=e.selectedOption,l=e.setValue,s=0===u.length,d=de()("relative flex flex-row items-center w-full px-8 py-2 text-left text-black border rounded-md border-slate-300 focus:outline focus:outline-yellow-500",{"text-slate-500":s});return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(le,{htmlFor:n,text:a}),(0,i.jsx)(je.R,{value:null===c||void 0===c?void 0:c.value,onChange:l,disabled:s,children:(0,i.jsxs)("div",{className:"relative mt-1",children:[(0,i.jsxs)(je.R.Button,{id:n,className:d,disabled:s,children:[(0,i.jsx)("div",{className:"absolute left-2",children:o}),(0,i.jsx)("div",{className:"flex-grow overflow-hidden text-ellipsis whitespace-nowrap",children:null!==(t=null===c||void 0===c?void 0:c.text)&&void 0!==t?t:r}),(0,i.jsx)(we.Ta4,{className:"absolute right-2",width:20,height:20})]}),(0,i.jsx)(je.R.Options,{className:"absolute z-10 w-full py-1 mt-1 overflow-auto text-base bg-white shadow-lg max-h-60 border rounded-md border-slate-300 focus:outline-none sm:text-sm",children:u.map((function(e){return(0,i.jsx)(je.R.Option,{value:e.value,children:function(t){var n=t.active,r=t.selected,o=de()("relative pl-8 p-2 cursor-pointer",{"bg-slate-200":n});return(0,i.jsxs)("div",{className:o,children:[r&&(0,i.jsx)(we.nQG,{className:"absolute left-2",width:20,height:20}),(0,i.jsx)("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:e.text})]})}},e.value)}))})]})})]})}function Se(e){var t=e.local,n=void 0!==t&&t,r=e.stream,o=e.videoDisabled,a=void 0!==o&&o,u=de()("h-full w-full object-cover rounded-md",{"scale-x-[-1]":n,hidden:a});return(0,i.jsx)("video",{ref:function(e){null!==e&&(e.srcObject=r)},tabIndex:-1,autoPlay:!0,muted:n,className:u})}function Ee(){var e=M(R,E);return(0,i.jsx)("div",{className:"w-full h-48 bg-slate-900 rounded-md",children:null!==e&&(0,i.jsx)(Se,{local:!0,stream:e})})}function ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ne(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(l){return void n(l)}u.done?t(c):Promise.resolve(c).then(r,o)}function Ce(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Ne(i,r,o,a,u,"next",e)}function u(e){Ne(i,r,o,a,u,"throw",e)}a(void 0)}))}}function Ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ae(e,t,n[t])}))}return e}function Ie(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return ke(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ke(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function De(){var e=(0,u.Zl)(N),t=Ie(a.useState(),2),n=t[0],r=t[1];a.useEffect((function(){Ce(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=r,e.next=3,U();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))()}),[]);var c,l,s=a.useCallback(Ce(o().mark((function t(){var n,r,i,a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=M(R,E),r=B(n),i=r.audioEnabled,a=r.videoEnabled,e(A(i,a));case 3:case"end":return t.stop()}}),t)}))),[e]),d=a.useCallback(function(){var e=Ce(o().mark((function e(t,r){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==n&&void 0!==t){e.next=2;break}return e.abrupt("return");case 2:return i=M(R,E),L(i),e.t0=R,e.t1=E,e.next=8,r(n);case 8:e.t2=e.sent,e.t0.set.call(e.t0,e.t1,e.t2);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[n]),f=a.useCallback((function(e){d(e,function(){var t=Ce(o().mark((function t(n){var i,a,u,c;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=null!==(a=n.audio.find((function(t){return t.id===e})))&&void 0!==a?a:null,t.next=5,Z({audioDeviceId:null===u||void 0===u?void 0:u.id,videoDeviceId:null===(i=n.selectedVideo)||void 0===i?void 0:i.id});case 5:return c=t.sent,r(Pe({},n,{selectedAudio:u})),t.abrupt("return",c);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}),[d]),v=a.useCallback((function(e){d(e,function(){var t=Ce(o().mark((function t(n){var i,a,u,c;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=null!==(a=n.video.find((function(t){return t.id===e})))&&void 0!==a?a:null,t.next=5,Z({videoDeviceId:null===u||void 0===u?void 0:u.id,audioDeviceId:null===(i=n.selectedAudio)||void 0===i?void 0:i.id});case 5:return c=t.sent,r(Pe({},n,{selectedVideo:u})),t.abrupt("return",c);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}),[d]);return(0,i.jsx)(me,{body:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Ee,{}),(0,i.jsx)(Oe,{id:"audio-select",fallback:"No microphones found",icon:(0,i.jsx)(we.S6n,{width:20}),label:"Microphone",selectedOption:(null===n||void 0===n?void 0:n.selectedAudio)?{value:n.selectedAudio.id,text:n.selectedAudio.name}:void 0,options:null!==(c=null===n||void 0===n?void 0:n.audio.map((function(e){return{value:e.id,text:e.name}})))&&void 0!==c?c:[],setValue:f}),(0,i.jsx)(Oe,{id:"video-select",fallback:"No cameras found",icon:(0,i.jsx)(we.y3v,{width:20}),label:"Camera",selectedOption:(null===n||void 0===n?void 0:n.selectedVideo)?{value:n.selectedVideo.id,text:n.selectedVideo.name}:void 0,options:null!==(l=null===n||void 0===n?void 0:n.video.map((function(e){return{value:e.id,text:e.name}})))&&void 0!==l?l:[],setValue:v})]}),handleSubmit:s,submitText:"Join room"})}var qe=n(1607);function Te(){return(0,i.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,i.jsx)(qe.Z,{type:"Oval",color:"#EAB308",height:60,width:60})})}var Re=n(3591);function Me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return Me(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Me(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(e){var t=e.children,n=e.disabled,r=void 0!==n&&n,o=e.text,a=de()("text-sm font-bold",{"text-red-500":r});return(0,i.jsxs)("div",{className:"flex flex-col items-center space-y-2 relative",children:[t,(0,i.jsx)("div",{className:a,children:o})]})}function Le(){var e=(0,c.useRouter)(),t=_e((0,u.FV)(N),2),n=t[0],r=t[1],o=(0,u.sJ)(p),l=M(R,E);j()("connecting"===n.status||"connected"===n.status);var s=B(l),d=s.audioEnabled,f=s.videoEnabled,v=a.useCallback((function(){e.push("/goodbye?left=".concat(e.query.roomCode,"/").concat(e.query.roomName),"/goodbye")}),[e]),b=a.useCallback((function(){o.forEach((function(e){var t=T.get(e.sid);void 0!==t&&J(t,{type:"peer-state",name:n.name,audioEnabled:!d,videoEnabled:f})}));var e=null===l||void 0===l?void 0:l.getAudioTracks();void 0!==e&&e.length>0&&(e[0].enabled=!d),r(C(!d,f))}),[d,n.name,o,r,l,f]),m=a.useCallback((function(){o.forEach((function(e){var t=T.get(e.sid);void 0!==t&&J(t,{type:"peer-state",name:n.name,audioEnabled:d,videoEnabled:!f})}));var e=null===l||void 0===l?void 0:l.getVideoTracks();void 0!==e&&e.length>0&&(e[0].enabled=!f),r(C(d,!f))}),[d,n.name,o,r,l,f]),h=de()("absolute",{"text-slate-800":!f}),y=de()("absolute",{"text-slate-800":!d});return(0,i.jsxs)("div",{className:"flex items-center justify-center m-2 sm:m-4 space-x-8",children:[(0,i.jsx)(Ve,{disabled:!d,text:"Mic",children:(0,i.jsx)(Re.Z,{color:d?"slate":"red",icon:(0,i.jsx)(we.S6n,{width:24,className:y}),onClick:b,square:!0})}),(0,i.jsx)(Ve,{disabled:!f,text:"Cam",children:(0,i.jsx)(Re.Z,{color:f?"slate":"red",icon:(0,i.jsx)(we.y3v,{width:24,className:h}),onClick:m,square:!0})}),(0,i.jsx)(Ve,{text:"Leave",children:(0,i.jsx)(Re.Z,{color:"slate",icon:(0,i.jsx)(we.qWc,{width:24,className:"absolute text-red-500"}),onClick:v,square:!0})})]})}var Fe=n(9612);function Ue(e){var t=e.audioDisabled,n=e.name,r=e.videoDisabled,o=de()("absolute flex items-center space-x-2 bottom-2 left-2 text-shadow z-10 sm:text-lg leading-none sm:leading-none max-w-full",{"sm:bottom-4 sm:left-4":!r}),a=de()("absolute",{"text-red-500":t});return(0,i.jsxs)("div",{className:o,children:[(0,i.jsx)(we.S6n,{width:20,className:a}),(0,i.jsx)("span",{className:"overflow-hidden text-ellipsis whitespace-nowrap pl-5 pr-4",children:n})]})}function Ze(e){var t=e.audioDisabled,n=e.loading,r=void 0!==n&&n,o=e.local,a=void 0!==o&&o,u=e.name,c=e.stream,l=e.videoDisabled,s=(0,i.jsx)(Ue,{audioDisabled:t,name:u,videoDisabled:l});return(0,i.jsx)("div",{className:"w-full h-full relative",children:r?(0,i.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,i.jsx)(Te,{})}):(0,i.jsxs)(i.Fragment,{children:[!l&&s,c&&(0,i.jsx)(Se,{local:a,videoDisabled:l,stream:c}),l&&(0,i.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,i.jsx)("div",{className:"flex items-center justify-center w-40 h-40 bg-indigo-500 rounded-md relative",children:s})})]})})}function Be(){var e=(0,u.sJ)(N);j()("connecting"===e.status||"connected"===e.status);var t=M(R,E),n=B(t),r=n.audioEnabled,o=n.videoEnabled;return(0,i.jsx)(Ze,{audioDisabled:!r,local:!0,name:"".concat(e.name," (You)"),stream:t,videoDisabled:!o})}function Je(e){var t=e.peer,n=R.get(t.sid);return(0,i.jsx)(Ze,{audioDisabled:!t.audioEnabled,loading:"connected"!==t.status,name:t.name,stream:n,videoDisabled:!t.videoEnabled})}function $e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ge(e){return function(e){if(Array.isArray(e))return $e(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return $e(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $e(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ze(){var e=(0,u.sJ)(p),t=(0,Fe.NB)(),n=t.width,r=t.height,o=t.ref,c=a.useMemo((function(){return[(0,i.jsx)(Be,{},"local")].concat(Ge(e.map((function(e){return(0,i.jsx)(Je,{peer:e},e.sid)}))))}),[e]),l=(null!==n&&void 0!==n?n:0)<(null!==r&&void 0!==r?r:0),s=c.length,d=Math.floor(Math.sqrt(s)),f=Math.ceil(s/d),v=l?d:f,b=l?f:d,m=a.useMemo((function(){return function(e,t){for(var n=[],r=0;r<e.length;)n.push(e.slice(r,r+=t));return n}(c,l?b:v)}),[v,l,c,b]),h=a.useMemo((function(){var e=window.innerWidth<640?4:8,t=(null!==n&&void 0!==n?n:0)/v,o=(null!==r&&void 0!==r?r:0)/b;return t/4>o/3&&(t=o/3*4),o>t&&(o=t),{cellWidth:t-(e*b-e),cellHeight:o-(e*b-e)}}),[v,r,b,n]),y=h.cellWidth,x=h.cellHeight,g=de()("flex items-center justify-center w-full h-full",{"flex-col":!l,"flex-row":l}),w=de()("flex",{"flex-row pb-2 sm:pb-4 last:pb-0 last:sm:pb-0":!l,"flex-col pr-2 sm:pr-4 last:pr-0 last:sm:pb-0":l}),j=de()("inline-block",{"pr-2 sm:pr-4 last:pr-0 last:sm:pr-0":!l,"pb-2 sm:pb-4 last:pb-0 last:sm:pb-0":l});return(0,i.jsx)("div",{className:"w-full h-full basis-full",children:(0,i.jsx)("div",{ref:o,className:g,children:m.map((function(e,t){return(0,i.jsx)("div",{className:w,children:e.map((function(e,t){return(0,i.jsx)("div",{className:j,style:{width:y,height:x},children:e},"video-".concat(t))}))},"row-".concat(t))}))})})}function We(){return(0,i.jsxs)("div",{className:"w-full h-full flex flex-col p-2 sm:p-4 pb-0 sm:pb-0",children:[(0,i.jsx)(ze,{}),(0,i.jsx)(Le,{})]})}function Xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ye(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(l){return void n(l)}u.done?t(c):Promise.resolve(c).then(r,o)}function He(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Ye(i,r,o,a,u,"next",e)}function u(e){Ye(i,r,o,a,u,"throw",e)}a(void 0)}))}}function Qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return Xe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ke(){var e=(0,c.useRouter)(),t=Qe((0,u.FV)(N),2),n=t[0],r=t[1],s=(0,u.Zl)(p),d=Qe((0,u.FV)(ie),2),f=d[0],v=d[1],b=a.useRef();return a.useEffect((function(){He(o().mark((function t(){var n,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isReady){t.next=2;break}return t.abrupt("return");case 2:n=e.query.roomCode,r=e.query.roomName,t.prev=4,(0,l.zD)(n,r),t.next=12;break;case 8:return t.prev=8,t.t0=t.catch(4),v(ae),t.abrupt("return");case 12:v(ue(r));case 13:case"end":return t.stop()}}),t,null,[[4,8]])})))()}),[e,v]),a.useEffect((function(){return function(){s(m),v(oe),r(k),void 0!==b.current&&b.current.disconnect(),R.forEach((function(e,t){null===e||void 0===e||e.getTracks().forEach((function(e){e.stop()})),R.delete(t)})),T.forEach((function(e,t){e.close(),T.delete(t)})),q.forEach((function(e,t){e.close(),q.delete(t)}))}}),[r,s,v]),a.useEffect((function(){He(o().mark((function t(){var i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"connecting"===n.status&&(i=e.query.roomCode,re(i,n,b,r,s));case 1:case"end":return t.stop()}}),t)})))()}),[n,e.query.roomCode,r,s]),(0,i.jsxs)("div",{className:"h-full w-full max-h-full max-w-full overflow-hidden",children:["loading"===f.status&&(0,i.jsx)(Te,{}),"error"===f.status&&(0,i.jsx)("p",{children:f.error}),"ready"===f.status&&(0,i.jsxs)(i.Fragment,{children:["requestingName"===n.status&&(0,i.jsx)(ye,{}),"requestingPermissions"===n.status&&(0,i.jsx)(ge,{}),"requestingDevices"===n.status&&(0,i.jsx)(De,{}),"connecting"===n.status&&(0,i.jsx)(Te,{}),"connected"===n.status&&(0,i.jsx)(We,{})]})]})}}},function(e){e.O(0,[641,677,774,888,179],(function(){return t=1736,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=[roomName]-4b20317ddc5c8d29.js.map